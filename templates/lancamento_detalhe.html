{% extends 'base.html' %}
{% load format_extras %}
{% block title %} Detalhes do Lançamento {{ lancamento.numero }} - ContabileX {% endblock %}
{% block page_title %} Detalhes do Lançamento {% endblock %}

{% block content %}
<style>
    .mov-debito {
        color: var(--success-color) !important;
    }

    .mov-credito {
        color: var(--danger-color) !important;
    }

    .mov-transparent {
        color: transparent !important;
    }
</style>
<div class="header-actions"
    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h3 style="margin-bottom: 0.5rem">Lançamento {{ lancamento.numero }}</h3>
        <p style="color: var(--text-secondary); font-size: 0.9rem">
            Detalhes resumidos dos movimentos contabilísticos.
        </p>
    </div>
    <div style="display: flex; gap: 0.5rem;">
        <a href="{% url 'lancamentos_list' %}" class="btn" style="border: 1px solid rgba(255,255,255,0.1);">
            <i class="fas fa-arrow-left"></i> Voltar
        </a>
    </div>
</div>

<div class="card" style="padding: 1.5rem; margin-bottom: 2rem;">
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
        <div>
            <h4
                style="color: var(--text-secondary); text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; margin-bottom: 0.5rem;">
                Data do Movimento</h4>
            <p style="font-size: 1.1rem; font-weight: 600;">{{ lancamento.data|date:"d/m/Y" }}</p>
        </div>
        <div>
            <h4
                style="color: var(--text-secondary); text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; margin-bottom: 0.5rem;">
                Descrição / Histórico</h4>
            <p style="font-size: 1.1rem; font-weight: 500;">{{ lancamento.descricao }}</p>
        </div>
    </div>
</div>

<div class="card" style="padding: 1.5rem;">
    <h4 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
        <i class="fas fa-list" style="color: var(--accent-color);"></i>
        Movimentos
    </h4>

    <div class="table-container">
        <table style="width: 100%;">
            <thead>
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <th style="text-align: left; padding: 1rem 0.5rem;">Conta</th>
                    <th style="text-align: right; padding: 1rem 0.5rem;">Débito</th>
                    <th style="text-align: right; padding: 1rem 0.5rem;">Crédito</th>
                </tr>
            </thead>
            <tbody>
                {% for mov in lancamento.movimentos.all %}
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 1rem 0.5rem;">
                        <div style="font-weight: 600;">{{ mov.conta.codigo }}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">{{ mov.conta.descricao }}</div>
                    </td>
                    <td class="{% if mov.tipo == 'D' %}mov-debito{% else %}mov-transparent{% endif %}"
                        style="text-align: right; padding: 1rem 0.5rem; font-weight: 500;">
                        {% if mov.tipo == 'D' %}Kz {{ mov.valor|format_moeda }}{% else %}-{% endif %}
                    </td>
                    <td class="{% if mov.tipo == 'C' %}mov-credito{% else %}mov-transparent{% endif %}"
                        style="text-align: right; padding: 1rem 0.5rem; font-weight: 500;">
                        {% if mov.tipo == 'C' %}Kz {{ mov.valor|format_moeda }}{% else %}-{% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr style="border-top: 2px solid var(--border-color); font-weight: bold;">
                    <td style="padding: 1rem 0.5rem; text-align: right;">TOTAIS:</td>
                    <td style="text-align: right; padding: 1rem 0.5rem; color: var(--success-color);">Kz {{
                        lancamento.total_debito|format_moeda }}</td>
                    <td style="text-align: right; padding: 1rem 0.5rem; color: var(--danger-color);">Kz {{
                        lancamento.total_credito|format_moeda }}</td>
                </tr>
            </tfoot>
        </table>
    </div>

    {% if lancamento.fatura %}
    <div
        style="margin-top: 2rem; padding: 1rem; background: rgba(88, 166, 255, 0.05); border-radius: 8px; border: 1px solid rgba(88, 166, 255, 0.1); display: flex; align-items: center; justify-content: space-between;">
        <span style="font-size: 0.9rem; color: var(--text-secondary);">Este lançamento está associado à Fatura
            <strong>{{ lancamento.fatura.numero }}</strong></span>
        <a href="{% url 'fatura_detalhe' lancamento.fatura.id %}" class="btn btn-sm"
            style="background: var(--accent-color); color: white;">Ver Fatura</a>
    </div>
    {% elif lancamento.compra %}
    <div
        style="margin-top: 2rem; padding: 1rem; background: rgba(88, 166, 255, 0.05); border-radius: 8px; border: 1px solid rgba(88, 166, 255, 0.1); display: flex; align-items: center; justify-content: space-between;">
        <span style="font-size: 0.9rem; color: var(--text-secondary);">Este lançamento está associado à Compra
            <strong>{{ lancamento.compra.numero }}</strong></span>
        <a href="{% url 'compra_detalhe' lancamento.compra.id %}" class="btn btn-sm"
            style="background: var(--accent-color); color: white;">Ver Compra</a>
    </div>
    {% endif %}
</div>
{% endblock %}