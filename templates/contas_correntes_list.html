{% extends 'base.html' %}

{% block title %}Contas Correntes{% endblock %}
{% block page_title %}Contas Correntes{% endblock %}

{% block content %}
<div class="card">
    <ul class="nav nav-tabs" id="ccTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="clientes-tab" data-bs-toggle="tab" href="#clientes" role="tab" aria-selected="true">Clientes</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="fornecedores-tab" data-bs-toggle="tab" href="#fornecedores" role="tab" aria-selected="false">Fornecedores</a>
        </li>
    </ul>
    
    <div class="tab-content" id="ccTabsContent" style="padding-top: 1.5rem;">
        <!-- TAB CLIENTES -->
        <div class="tab-pane fade show active" id="clientes" role="tabpanel">
             <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Cliente</th>
                            <th>NIF</th>
                            <th class="text-end">Saldo Atual</th>
                            <th class="text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for c in lista_clientes %}
                        <tr>
                            <td>{{ c.codigo_contabilistico }}</td>
                            <td>{{ c.nome }}</td>
                            <td>{{ c.nif|default:"-" }}</td>
                            <td class="text-end font-weight-bold {% if c.saldo > 0 %}text-success{% elif c.saldo < 0 %}text-danger{% endif %}">
                                {{ c.saldo|floatformat:2 }} Kz
                            </td>
                            <td class="text-center">
                                <a href="{% url 'conta_corrente_detalhe' 'cliente' c.id %}" class="btn btn-sm btn-outline-primary" title="Ver Extrato">
                                    <i class="fas fa-list-alt"></i> Extrato
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">Ainda não existem clientes registados.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB FORNECEDORES -->
        <div class="tab-pane fade" id="fornecedores" role="tabpanel">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Fornecedor</th>
                            <th>NIF</th>
                            <th class="text-end">Saldo a Pagar</th>
                            <th class="text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for f in lista_fornecedores %}
                        <tr>
                            <td>{{ f.codigo_contabilistico }}</td>
                            <td>{{ f.nome }}</td>
                            <td>{{ f.nif|default:"-" }}</td>
                            <td class="text-end font-weight-bold {% if f.saldo > 0 %}text-danger{% elif f.saldo < 0 %}text-success{% endif %}">
                                {{ f.saldo|floatformat:2 }} Kz
                            </td>
                            <td class="text-center">
                                <a href="{% url 'conta_corrente_detalhe' 'fornecedor' f.id %}" class="btn btn-sm btn-outline-primary" title="Ver Extrato">
                                    <i class="fas fa-list-alt"></i> Extrato
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">Ainda não existem fornecedores registados.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // Tab switching vanilla JS
    const triggerTabList = [].slice.call(document.querySelectorAll('#ccTabs a'))
    triggerTabList.forEach(function (triggerEl) {
      triggerEl.addEventListener('click', function (event) {
        event.preventDefault()
        // Here we would ideally use Bootstrap's Tab plugin but we can do a simple class toggle
        // For simplicity, assuming bootstrap js is loaded or we do simple switching
        document.querySelectorAll('.tab-pane').forEach(p => {
            p.classList.remove('show', 'active');
        });
        document.querySelectorAll('.nav-link').forEach(p => {
            p.classList.remove('active');
        });
        
        // Activate
        this.classList.add('active');
        const targetId = this.getAttribute('href').substring(1);
        const target = document.getElementById(targetId);
        if(target) target.classList.add('show', 'active');
      })
    })
</script>
{% endblock %}
