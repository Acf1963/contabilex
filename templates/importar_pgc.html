{% extends 'base.html' %}

{% block title %} Importar Plano de Contas - ContabileX {% endblock %}
{% block page_title %} Importar PGC {% endblock %}

{% block content %}
<div class="card" style="max-width: 600px; margin: 0 auto; padding: 2rem;">
    <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
        <i class="fas fa-file-import" style="color: var(--accent-color);"></i>
        Importar Plano de Contas
    </h3>
    
    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
        Carregue um ficheiro de texto (.txt) ou Excel (.xlsx) para popular o seu plano de contas.
    </p>

    <div class="alert alert-info" style="background: rgba(var(--accent-rgb), 0.1); border: 1px solid var(--accent-color); padding: 1rem; border-radius: 8px; margin-bottom: 2rem; font-size: 0.9rem;">
        <strong>Estrutura esperada:</strong><br>
        1. Código da Conta (ex: 31.1)<br>
        2. Descrição<br>
        3. Tipo (R = Razão, I = Integração, M = Movimento, A = Apuramento)
    </div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group" style="margin-bottom: 1.5rem;">
            <label class="form-label">{{ form.arquivo.label }}</label>
            {{ form.arquivo }}
            {% if form.arquivo.errors %}
                <div style="color: var(--danger-color); margin-top: 0.5rem; font-size: 0.9rem;">
                    {% for error in form.arquivo.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            <small style="display: block; margin-top: 0.5rem; color: var(--text-secondary);">
                {{ form.arquivo.help_text }}
            </small>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button type="submit" class="btn btn-primary" style="flex: 2;">
                <i class="fas fa-upload"></i> Processar Ficheiro
            </button>
            <a href="{% url 'plano_contas' %}" class="btn btn-outline" style="flex: 1; text-align: center;">
                Cancelar
            </a>
        </div>
    <!-- Loading Indicator (Hidden by default) -->
    <div id="loading-overlay" style="display: none; text-align: center; margin-top: 2rem;">
        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--accent-color);"></i>
        <p style="margin-top: 1rem; color: var(--text-secondary);">A processar o ficheiro, por favor aguarde...</p>
    </div>
</div>

<script>
    document.querySelector('form').addEventListener('submit', function(e) {
        // Show loading
        document.querySelector('#loading-overlay').style.display = 'block';
        
        // Hide buttons to prevent double submit
        const buttons = this.querySelector('div[style*="display: flex"]');
        if(buttons) buttons.style.display = 'none';
        
        // Optional: Change button text if we kept it visible
        // e.target.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-spinner fa-spin"></i> A Processar...';
    });
</script>
{% endblock %}
