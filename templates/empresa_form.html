{% extends 'base.html' %}

{% block title %} Configurações - ContabileX {% endblock %}
{% block page_title %} Editar: {{ empresa.nome }} {% endblock %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 0 auto; padding: 2rem;">
    <h3 style="margin-bottom: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">Alterar Dados da Empresa</h3>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
            <div class="form-group" style="grid-column: span 2;">
                <label class="form-label">Nome da Empresa</label>
                {{ form.nome }}
            </div>

            <div class="form-group">
                <label class="form-label">NIF</label>
                {{ form.nif }}
            </div>

            <div class="form-group">
                <label class="form-label">Ano do Exercício</label>
                {{ form.ano_exercicio }}
            </div>

            <div class="form-group" style="grid-column: span 2;">
                <label class="form-label">Morada / Endereço</label>
                {{ form.morada }}
            </div>

            <div class="form-group">
                <label class="form-label">Email de Contacto</label>
                {{ form.email }}
            </div>

            <div class="form-group">
                <label class="form-label">Telefone</label>
                {{ form.telefone }}
            </div>

            <div class="form-group">
                <label class="form-label">Modelo de Plano de Contas</label>
                {{ form.plano_modelo }}
            </div>

            <div class="form-group" style="grid-column: span 2;">
                <label class="form-label">Logótipo</label>
                {{ form.logo }}
                {% if empresa.logo %}
                <div style="margin-top: 1rem;">
                    <img src="{{ empresa.logo.url }}" alt="Logo" style="max-height: 100px; border: 1px solid var(--border-color); border-radius: 4px;">
                </div>
                {% endif %}
            </div>

            <!-- Configurações Financeiras -->
            <div style="grid-column: span 2; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                <h5 style="margin-bottom: 1.5rem; color: var(--accent-color);">
                    <i class="fas fa-coins"></i> Configurações de Moeda & Câmbio
                </h5>
            </div>

            <div class="currency-exchange-container" style="grid-column: span 2; display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; align-items: end; background: rgba(0,0,0,0.1); padding: 1rem; border-radius: 8px;">
                <div class="form-group">
                    <label class="form-label">Moeda de Referência</label>
                    {{ form.moeda_estrangeira }}
                    <div style="margin-top: 0.5rem; font-weight: bold; font-size: 1.1rem; text-align: center;">1.00</div>
                </div>
                
                <div style="padding-bottom: 1.2rem; font-size: 1.2rem; color: var(--text-secondary);">=</div>
                
                <div class="form-group">
                    <label class="form-label">Moeda Base (Kwanza)</label>
                    {{ form.moeda_padrao }}
                    <div style="margin-top: 0.5rem;">
                        {{ form.taxa_cambio }}
                    </div>
                </div>
            </div>
            <div style="grid-column: span 2; text-align: right; margin-top: -0.5rem;">
                <a href="{% url 'lista_cambios' %}" style="font-size: 0.85rem; color: var(--accent-color); text-decoration: none;">
                    <i class="fas fa-history"></i> Gerir Histórico de Câmbios
                </a>
            </div>
        </div>

        <div style="margin-top: 2rem; display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-primary" style="padding: 0.8rem 2rem;">
                <i class="fas fa-save" style="margin-right: 0.5rem;"></i> Atualizar Dados
            </button>
            <a href="{% url 'configuracao_empresa' %}" class="btn" style="background: rgba(255,255,255,0.05);">
                Cancelar
            </a>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const monedaEst = document.querySelector('select[name="moeda_estrangeira"]');
        const taxaCambio = document.querySelector('input[name="taxa_cambio"]');
        const bnaRates = {
            'USD': '{{ bna_rates.USD }}',
            'EUR': '{{ bna_rates.EUR }}',
            'AOA': '1.000000'
        };

        if (monedaEst && taxaCambio) {
            monedaEst.addEventListener('change', function() {
                const selected = this.value;
                if (bnaRates[selected]) {
                    taxaCambio.value = bnaRates[selected];
                    // Trigger a visual feedback or subtle animation
                    taxaCambio.style.transition = 'background-color 0.5s';
                    taxaCambio.style.backgroundColor = 'rgba(88, 166, 255, 0.2)';
                    setTimeout(() => {
                        taxaCambio.style.backgroundColor = '';
                    }, 500);
                }
            });
        }
    });
</script>
{% endblock %}
