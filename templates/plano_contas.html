{% extends 'base.html' %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h1 style="margin: 0; font-size: 1.75rem;">Plano Geral de Contabilidade</h1>
        <p style="color: var(--text-secondary); margin: 0.25rem 0 0 0;">Gestão das contas e estrutura do balanço</p>
    </div>
    <div style="display: flex; gap: 0.5rem;">
        <a href="{% url 'importar_plano_contas' %}" class="btn btn-outline" title="Importar" style="text-decoration: none; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; padding: 0;">
            <i class="fas fa-file-import"></i>
        </a>
        <a href="{% url 'exportar_plano_contas_excel' %}" class="btn btn-outline" title="Exportar Excel" style="text-decoration: none; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; padding: 0;">
            <i class="fas fa-file-excel" style="color: #217346;"></i>
        </a>
        <a href="{% url 'pdf_plano_contas' %}" target="_blank" class="btn btn-secondary" title="Gerar PDF" style="text-decoration: none; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; padding: 0;">
            <i class="fas fa-file-pdf"></i>
        </a>
        <a href="{% url 'nova_conta' %}" class="btn btn-primary" title="Nova Conta" style="text-decoration: none; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; padding: 0;">
            <i class="fas fa-list-ol"></i>
        </a>
    </div>
</div>

<div class="card" style="padding: 0; overflow: hidden; display: flex; flex-direction: column; max-height: calc(100vh - 200px); border-radius: 8px; border: 1px solid var(--border-color);">
    <!-- Cabeçalho Fixo (Fora da área de rolagem) -->
    <div style="background: var(--bg-card); border-bottom: 1px solid var(--border-color);">
        <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
            <thead>
                <tr style="text-align: left;">
                    <th style="width: 15%; padding: 1.25rem 1rem; color: var(--text-secondary); font-weight: 600;">Código</th>
                    <th style="width: 35%; padding: 1.25rem 1rem; color: var(--text-secondary); font-weight: 600;">Descrição</th>
                    <th style="width: 12%; padding: 1rem; color: var(--text-secondary); font-weight: 600;">Tipo</th>
                    <th style="width: 18%; padding: 1rem; color: var(--text-secondary); font-weight: 600;">Natureza</th>
                    <th style="width: 8%; padding: 1rem; color: var(--text-secondary); font-weight: 600; text-align: center;">Mov?</th>
                    <th style="width: 12%; padding: 1rem; color: var(--text-secondary); font-weight: 600; text-align: right;">Ações</th>
                </tr>
            </thead>
        </table>
    </div>

    <!-- Área de Rolagem -->
    <div style="overflow-y: auto; flex: 1; scrollbar-gutter: stable;">
        <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
            <tbody>
                {% for conta in contas %}
                <tr class="conta-row {{ conta.tipo|lower }}">
                    <td style="width: 15%; padding: 1rem; color: var(--accent-color); font-weight: 500;">{{ conta.codigo }}</td>
                    <td style="width: 35%; padding: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        {% if conta.tipo == 'INTEGRACAO' %}<span class="indent-int"></span>{% elif conta.tipo == 'MOVIMENTO' %}<span class="indent-mov"></span>{% endif %}
                        {{ conta.descricao }}
                    </td>
                    <td style="width: 12%; padding: 1rem;">
                        <span class="badge badge-type badge-{{ conta.tipo|lower }}">
                            {{ conta.get_tipo_display }}
                        </span>
                    </td>
                    <td style="width: 18%; padding: 1rem;">
                        {% if conta.tipo_entidade != 'NENHUM' %}
                        <span style="font-size: 0.8rem; color: var(--text-primary); display: flex; align-items: center; gap: 0.4rem;">
                            {% if conta.tipo_entidade == 'CLIENTE' %}<i class="fas fa-user-tie" style="color: #3fb950;"></i>
                            {% elif conta.tipo_entidade == 'FORNECEDOR' %}<i class="fas fa-truck" style="color: #f85149;"></i>
                            {% elif conta.tipo_entidade == 'ESTADO' %}<i class="fas fa-landmark" style="color: #d29922;"></i>
                            {% elif conta.tipo_entidade == 'BANCO' %}<i class="fas fa-university" style="color: #58a6ff;"></i>
                            {% elif conta.tipo_entidade == 'CAIXA' %}<i class="fas fa-cash-register" style="color: #bc8cff;"></i>
                            {% endif %}
                            {{ conta.get_tipo_entidade_display }}
                        </span>
                        {% else %}
                        <span style="color: var(--text-secondary); opacity: 0.5; font-size: 0.8rem;">Geral</span>
                        {% endif %}
                    </td>
                    <td style="width: 8%; padding: 1rem; text-align: center;">
                        {% if conta.aceita_lancamentos %}
                        <i class="fas fa-check-circle" style="color: var(--accent-color);"></i>
                        {% else %}
                        <i class="fas fa-minus" style="color: var(--text-secondary); opacity: 0.3;"></i>
                        {% endif %}
                    </td>
                    <td style="width: 12%; padding: 1rem; text-align: right; display: flex; gap: 0.25rem; justify-content: flex-end;">
                        <a href="{% url 'editar_conta' conta.pk %}" class="btn btn-sm btn-outline" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'eliminar_conta' conta.pk %}" class="btn btn-sm btn-outline btn-delete" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; color: var(--danger-color); border-color: rgba(248,81,73,0.2);" title="Eliminar" onclick="return confirm('Tem a certeza que deseja eliminar a conta {{ conta.codigo }}? Esta ação não pode ser desfeita.')">
                            <i class="fas fa-trash-alt"></i>
                        </a>
                    </td>
                </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                    Nenhuma conta configurada no plano.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
    <div class="card" style="padding: 1rem; border-left: 4px solid var(--primary-color);">
        <h4 style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">RAZÃO</h4>
        <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem;">Contas de 2 dígitos. Base da hierarquia do PGC.</p>
    </div>
    <div class="card" style="padding: 1rem; border-left: 4px solid var(--warning-color);">
        <h4 style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">INTEGRAÇÃO</h4>
        <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem;">Contas intermediárias (3-4 dígitos) para consolidação.</p>
    </div>
    <div class="card" style="padding: 1rem; border-left: 4px solid var(--success-color);">
        <h4 style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">MOVIMENTO</h4>
        <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem;">Contas de lançamento (5+ dígitos). Aceitam movimentos.</p>
    </div>
</div>

<style>
    .conta-row { border-bottom: 1px solid var(--border-color); }
    .conta-row.razao { font-weight: bold; background: rgba(255,255,255,0.02); }
    .conta-row.integracao { background: rgba(255,255,255,0.01); }
    .indent-int { display: inline-block; width: 1.5rem; }
    .indent-mov { display: inline-block; width: 3rem; }
    .badge-type { font-size: 0.7rem; color: white; }
    .badge-razao { background: var(--primary-color); }
    .badge-integracao { background: var(--warning-color); }
    .badge-movimento { background: var(--success-color); }
</style>
{% endblock %}
