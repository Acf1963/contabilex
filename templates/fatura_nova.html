{% extends 'base.html' %}

{% block title %}
Nova Fatura - ContabileX
{% endblock %}

{% block page_title %}
Nova Fatura
{% endblock %}

{% block content %}
<div class="card" style="max-width: 900px; margin: 0 auto; padding: 2rem;">
    <h3 style="margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 1rem;">
        Detalhes da Fatura
    </h3>

    <form method="post">
        {% csrf_token %}
        
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <div class="form-group">
                <label class="form-label">Cliente</label>
                {{ form.cliente }}
            </div>
            <div class="col-md-3">
                <label>Vencimento</label>
                {{ form.data_vencimento }}
            </div>
            <div class="col-md-3" style="display: flex; flex-direction: column; gap: 0.5rem;">
               <div style="background: rgba(255,255,255,0.05); padding: 0.5rem 1rem; border-radius: 8px; display: flex; align-items: center; gap: 0.5rem;">
                   {{ form.aplicar_retencao }}
                   <label for="{{ form.aplicar_retencao.id_for_label }}" style="margin: 0; cursor: pointer; font-size: 0.9rem;">Aplicar Retenção</label>
               </div>
               <div id="div_taxa_retencao">
                   {{ form.taxa_retencao }}
               </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-4">
                <label>Condições</label>
                {{ form.condicoes_pagamento }}
            </div>
        </div>

        <div class="form-group">
             <label class="form-label">Observações</label>
             {{ form.observacoes }}
        </div>

        <h4 style="margin: 2rem 0 1rem 0; color: var(--accent-color);">Itens da Fatura</h4>
        
        <table style="width: 100%; margin-bottom: 2rem; border-collapse: separate; border-spacing: 0 0.5rem;">
            <thead>
                <tr>
                    <th style="width: 40%">Descrição</th>
                    <th style="width: 15%">Qtd</th>
                    <th style="width: 20%">Preço Unit.</th>
                    <th style="width: 15%">Imposto (%)</th>
                </tr>
            </thead>
            <tbody>
                {{ formset.management_form }}
                {% for item_form in formset %}
                <tr>
                    <td style="padding-right: 0.5rem;">{{ item_form.descricao }}</td>
                    <td style="padding-right: 0.5rem;">{{ item_form.quantidade }}</td>
                    <td style="padding-right: 0.5rem;">{{ item_form.preco_unitario }}</td>
                    <td>{{ item_form.taxa_imposto }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.05);">
            <a href="{% url 'faturas_list' %}" class="btn" style="background: rgba(255,255,255,0.05); text-decoration: none; color: white; display: inline-block;">Cancelar</a>
            <button type="submit" class="btn btn-primary">Emitir Fatura</button>
        </div>
    </form>
</div>
{% endblock %}
